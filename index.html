<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planilha Online – Ganhos & Gastos</title>
  <style>
    :root {
      --bg: #0f172a;
      /* slate-900 */
      --panel: #111827;
      /* gray-900 */
      --muted: #1f2937;
      /* gray-800 */
      --text: #e5e7eb;
      /* gray-200 */
      --text-dim: #9ca3af;
      /* gray-400 */
      --primary: #22c55e;
      /* green-500 */
      --danger: #ef4444;
      /* red-500 */
      --warning: #f59e0b;
      /* amber-500 */
      --accent: #38bdf8;
      /* sky-400 */
      --radius: 16px;
      --shadow: 0 10px 25px rgba(0, 0, 0, .35);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
      background: linear-gradient(180deg, #0b1220, #0f172a 40% 100%);
      color: var(--text);
    }

    /* ---------- Utilidades ---------- */
    .container {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }

    .card {
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .card.pad {
      padding: 16px;
    }

    .row {
      display: grid;
      gap: 12px;
    }

    @media (min-width: 768px) {
      .row.cols-2 {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (min-width: 1024px) {
      .row.cols-3 {
        grid-template-columns: 1fr 1fr 1fr;
      }
    }

    .btn {
      appearance: none;
      border: none;
      border-radius: 999px;
      padding: 12px 16px;
      font-weight: 600;
      cursor: pointer;
      background: var(--muted);
      color: var(--text);
      transition: transform .04s ease, opacity .2s ease, filter .2s ease;
    }

    .btn:hover {
      filter: brightness(1.1);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn.primary {
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: #062a12;
    }

    .btn.warn {
      background: #1f2937;
      border: 1px solid var(--warning);
      color: var(--text);
    }

    .btn.danger {
      background: #1f2937;
      border: 1px solid var(--danger);
      color: var(--text);
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid #334155;
    }

    .input,
    select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      background: #0b1220;
      color: var(--text);
      border: 1px solid #233047;
      outline: none;
    }

    .input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, .15);
    }

    label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--text-dim);
      display: block;
      margin: 10px 0 6px;
    }

    .badge {
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 999px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge.income {
      background: rgba(34, 197, 94, .15);
      color: #86efac;
      border: 1px solid rgba(34, 197, 94, .3);
    }

    .badge.expense {
      background: rgba(239, 68, 68, .15);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, .3);
    }

    header.appbar {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(8px);
      background: rgba(2, 6, 23, .65);
      border-bottom: 1px solid #1f2937;
    }

    .appbar-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
    }

    .brand .logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #06b6d4, #22d3ee 60%, #0ea5e9);
      box-shadow: inset 0 0 15px rgba(255, 255, 255, .15), 0 8px 20px rgba(14, 165, 233, .25);
    }

    .brand span {
      letter-spacing: .02em;
    }

    .stat {
      padding: 14px;
      border-radius: 12px;
      background: #0b1220;
      border: 1px solid #1f2937;
    }

    .stat h3 {
      margin: 0 0 6px;
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: .08em;
      text-transform: uppercase;
    }

    .stat p {
      margin: 0;
      font-size: 20px;
      font-weight: 800;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead th {
      position: sticky;
      top: 0;
      background: #0b1220;
      color: var(--text-dim);
      text-align: left;
      padding: 12px;
      font-size: 12px;
      letter-spacing: .08em;
      text-transform: uppercase;
      border-bottom: 1px solid #233047;
    }

    tbody td {
      padding: 12px;
      border-bottom: 1px solid #1f2937;
      vertical-align: middle;
    }

    tbody tr:hover {
      background: rgba(56, 189, 248, .05);
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .footer {
      color: var(--text-dim);
      font-size: 12px;
      text-align: center;
      margin: 24px 0 12px;
    }

    /* Login */
    .login-wrap {
      display: grid;
      min-height: 100dvh;
      place-items: center;
      padding: 24px;
    }

    .login {
      width: 100%;
      max-width: 420px;
    }

    .login h1 {
      margin: 0 0 14px;
    }

    /* Mobile helpers */
    .sticky-bottom {
      position: sticky;
      bottom: 0;
      padding-top: 12px;
      background: linear-gradient(180deg, transparent, rgba(2, 6, 23, .8));
    }
  </style>
</head>

<body>
  <!-- LOGIN -->
  <section id="login-view" class="login-wrap">
    <div class="card pad login">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
        <div class="logo"
          style="width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#16a34a,#22c55e 60%,#86efac);">
        </div>
        <h1>Entrar na Planilha</h1>
      </div>
      <p style="margin-top:-6px;color:var(--text-dim)">Use seu usuário e senha para acessar.</p>
      <form id="login-form">
        <label for="user">Usuário</label>
        <input class="input" id="user" autocomplete="username" placeholder="Usuario" required>
        <label for="pass">Senha</label>
        <input class="input" id="pass" type="password" autocomplete="current-password" placeholder="••••" required>
        <div style="display:flex;gap:8px;margin-top:14px;align-items:center;justify-content:space-between;">
          <button class="btn primary" type="submit">Entrar</button>
          <small style="color:var(--text-dim)">Dica: <code>wandersson</code> / <code>Ano</code></small>
        </div>
      </form>
    </div>
  </section>

  <!-- APP -->
  <section id="app" style="display:none;">
    <header class="appbar">
      <div class="appbar-inner container">
        <div class="brand">
          <div class="logo"></div>
          <span>Planilha de Ganhos & Gastos</span>
        </div>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="btn-export" class="btn ghost" title="Exportar JSON">Exportar</button>
          <button id="btn-logout" class="btn danger">Sair</button>
        </div>
      </div>
    </header>

    <main class="container" style="display:grid; gap:16px;">
      <!-- Filtros -->
      <div class="card pad">
        <form id="filters" class="row cols-3" style="align-items:end;">
          <div>
            <label for="filter-month">Mês</label>
            <select id="filter-month"></select>
          </div>
          <div>
            <label for="filter-year">Ano</label>
            <select id="filter-year"></select>
          </div>
          <div style="display:flex; gap:8px;">
            <button type="submit" class="btn primary" style="flex:1;">Aplicar Filtro</button>
            <button id="btn-clear-filter" class="btn" type="button">Limpar</button>
          </div>
        </form>
      </div>

      <!-- Resumo -->
      <div class="row cols-3">
        <div class="stat">
          <h3>Ganhos (mês)</h3>
          <p id="sum-income">R$ 0,00</p>
        </div>
        <div class="stat">
          <h3>Gastos (mês)</h3>
          <p id="sum-expense">R$ 0,00</p>
        </div>
        <div class="stat">
          <h3>Saldo (mês)</h3>
          <p id="sum-balance">R$ 0,00</p>
        </div>
      </div>

      <!-- Form de lançamento -->
      <div class="card pad">
        <form id="form" class="row cols-3">
          <div>
            <label for="type">Tipo</label>
            <select id="type" required>
              <option value="income">Ganho</option>
              <option value="expense">Gasto</option>
            </select>
          </div>
          <div>
            <label for="date">Data</label>
            <input id="date" class="input" type="date" required>
          </div>
          <div>
            <label for="amount">Valor</label>
            <input id="amount" class="input" inputmode="decimal" placeholder="0,00" required>
          </div>
          <div>
            <label for="desc">Descrição</label>
            <input id="desc" class="input" placeholder="Ex.: Salário, Mercado, Uber" required>
          </div>
          <div>
            <label for="category">Categoria</label>
            <input id="category" class="input" list="cats" placeholder="Selecione ou digite">
            <datalist id="cats">
              <option>Alimentação</option>
              <option>Transporte</option>
              <option>Moradia</option>
              <option>Saúde</option>
              <option>Lazer</option>
              <option>Educação</option>
              <option>Salário</option>
              <option>Freelance</option>
              <option>Outros</option>
            </datalist>
          </div>
          <div class="sticky-bottom">
            <button class="btn primary" type="submit" style="width:100%;">Adicionar Lançamento</button>
          </div>
        </form>
      </div>

      <!-- Tabela -->
      <div class="card pad">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;gap:8px;">
          <h2 style="margin:0;">Lançamentos</h2>
          <div style="display:flex;gap:8px;">
            <button id="btn-import" class="btn ghost" type="button" title="Importar JSON">Importar</button>
            <input id="import-file" type="file" accept="application/json" style="display:none;">
          </div>
        </div>
        <div style="overflow:auto; max-height: 55vh; border: 1px solid #1f2937; border-radius: 12px;">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Tipo</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Valor</th>
                <th style="width:110px;">Ações</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>

      <p class="footer">Dados salvos no seu navegador (localStorage). Exporte para fazer backup.</p>
    </main>
  </section>

  <script>
    // ====== Storage Helpers ======
    const STORAGE_KEY = 'wg_financas_transacoes_v1';
    const SESSION_KEY = 'wg_financas_session';

    const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    const pad = (n) => String(n).padStart(2, '0');

    function load() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch { return []; }
    }
    function save(list) { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    let data = load();

    // ====== Login ======
    const loginView = document.getElementById('login-view');
    const appView = document.getElementById('app');
    const loginForm = document.getElementById('login-form');

    function showApp() {
      loginView.style.display = 'none';
      appView.style.display = 'block';
      populateMonthYearSelectors();
      applyFilter();
    }

    // Persist session
    const existingSession = sessionStorage.getItem(SESSION_KEY);
    if (existingSession === 'ok') showApp();

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const u = document.getElementById('user').value.trim().toLowerCase();
      const p = document.getElementById('pass').value;
      if (u === 'wandersson' && p === '2025') {
        sessionStorage.setItem(SESSION_KEY, 'ok');
        showApp();
      } else {
        alert('Usuário ou senha inválidos.');
      }
    });

    document.getElementById('btn-logout').addEventListener('click', () => {
      sessionStorage.removeItem(SESSION_KEY);
      location.reload();
    });

    // ====== Filtros (Mês/Ano) ======
    const monthSel = document.getElementById('filter-month');
    const yearSel = document.getElementById('filter-year');

    function populateMonthYearSelectors() {
      const months = [
        '01 - Janeiro', '02 - Fevereiro', '03 - Março', '04 - Abril', '05 - Maio', '06 - Junho',
        '07 - Julho', '08 - Agosto', '09 - Setembro', '10 - Outubro', '11 - Novembro', '12 - Dezembro'
      ];
      monthSel.innerHTML = months.map((m, i) => `<option value="${i + 1}">${m}</option>`).join('');

      // Anos baseados nos dados + ano atual
      const yearsInData = new Set(data.map(x => new Date(x.date).getFullYear()).filter(Boolean));
      const currentYear = new Date().getFullYear();
      yearsInData.add(currentYear);
      const years = Array.from(yearsInData).sort((a, b) => a - b);
      yearSel.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');

      // Seleciona mês/ano atuais
      const now = new Date();
      monthSel.value = String(now.getMonth() + 1);
      yearSel.value = String(now.getFullYear());
    }

    document.getElementById('filters').addEventListener('submit', (e) => {
      e.preventDefault();
      applyFilter();
    });

    document.getElementById('btn-clear-filter').addEventListener('click', () => {
      const now = new Date();
      monthSel.value = String(now.getMonth() + 1);
      yearSel.value = String(now.getFullYear());
      applyFilter();
    });

    // ====== Form Lançamento ======
    const form = document.getElementById('form');
    const tbody = document.getElementById('tbody');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const type = document.getElementById('type').value;
      const date = document.getElementById('date').value; // yyyy-mm-dd
      const amountRaw = document.getElementById('amount').value;
      const desc = document.getElementById('desc').value.trim();
      const category = document.getElementById('category').value.trim();

      if (!date) return alert('Informe a data');

      const amount = parseBRL(amountRaw);
      if (isNaN(amount)) return alert('Valor inválido');

      const item = {
        id: crypto.randomUUID(),
        type, // 'income' | 'expense'
        date, // ISO yyyy-mm-dd
        amount, // number (centavos)
        desc,
        category
      };

      data.push(item);
      save(data);
      form.reset();
      // mantém tipo selecionado e data de hoje
      document.getElementById('type').value = type;
      document.getElementById('date').value = new Date().toISOString().slice(0, 10);
      applyFilter();
    });

    // Helper: converte texto BRL (1.234,56) para número em reais
    function parseBRL(str) {
      if (!str) return NaN;
      const s = String(str).replace(/\./g, '').replace(',', '.').replace(/[^0-9.-]/g, '');
      return Number(s);
    }

    // Formata número como BRL
    function brl(n) { return fmt.format(n || 0); }

    // ====== Render + Filtro ======
    function applyFilter() {
      const m = Number(monthSel.value);
      const y = Number(yearSel.value);

      const filtered = data.filter(x => {
        const d = new Date(x.date + 'T00:00:00');
        return d.getMonth() + 1 === m && d.getFullYear() === y;
      }).sort((a, b) => a.date.localeCompare(b.date));

      renderTable(filtered);
      renderSummary(filtered);
    }

    function renderSummary(list) {
      const incomes = list.filter(x => x.type === 'income').reduce((s, x) => s + x.amount, 0);
      const expenses = list.filter(x => x.type === 'expense').reduce((s, x) => s + x.amount, 0);
      const balance = incomes - expenses;
      document.getElementById('sum-income').textContent = brl(incomes);
      document.getElementById('sum-expense').textContent = brl(expenses);
      const balEl = document.getElementById('sum-balance');
      balEl.textContent = brl(balance);
      balEl.style.color = balance >= 0 ? '#86efac' : '#fca5a5';
    }

    function renderTable(list) {
      if (!list.length) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:var(--text-dim);padding:20px;">Nenhum lançamento neste mês.</td></tr>`;
        return;
      }
      tbody.innerHTML = list.map(row => {
        const d = new Date(row.date + 'T00:00:00');
        const date = `${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${d.getFullYear()}`;
        const badge = row.type === 'income' ? '<span class="badge income">Ganho</span>' : '<span class="badge expense">Gasto</span>';
        return `
          <tr data-id="${row.id}">
            <td>${date}</td>
            <td>${badge}</td>
            <td>${escapeHtml(row.desc || '')}</td>
            <td>${escapeHtml(row.category || '')}</td>
            <td style="font-weight:800;">${brl(row.amount)}</td>
            <td>
              <div class="actions">
                <button class="btn ghost" data-action="edit">Editar</button>
                <button class="btn warn" data-action="dup">Duplicar</button>
                <button class="btn danger" data-action="del">Excluir</button>
              </div>
            </td>
          </tr>`;
      }).join('');
    }

    function escapeHtml(s) {
      return String(s).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;');
    }

    // Ações linha
    tbody.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const tr = e.target.closest('tr');
      const id = tr?.dataset?.id;
      const idx = data.findIndex(x => x.id === id);
      if (idx === -1) return;

      if (btn.dataset.action === 'del') {
        if (confirm('Excluir lançamento?')) {
          data.splice(idx, 1);
          save(data);
          applyFilter();
        }
      }
      if (btn.dataset.action === 'dup') {
        const copy = { ...data[idx], id: crypto.randomUUID() };
        data.push(copy);
        save(data);
        applyFilter();
      }
      if (btn.dataset.action === 'edit') {
        const item = data[idx];
        const novadata = prompt('Data (AAAA-MM-DD):', item.date) || item.date;
        const novotipo = prompt('Tipo (income/expense):', item.type) || item.type;
        const novadesc = prompt('Descrição:', item.desc) ?? item.desc;
        const novacat = prompt('Categoria:', item.category) ?? item.category;
        const novoval = prompt('Valor (use vírgula para centavos):', String(item.amount).replace('.', ','));
        const num = novoval ? parseBRL(novoval) : item.amount;
        if (isNaN(num)) return alert('Valor inválido');
        Object.assign(item, { date: novadata, type: novotipo, desc: novadesc, category: novacat, amount: num });
        save(data);
        applyFilter();
      }
    });

    // ====== Import/Export ======
    const exportBtn = document.getElementById('btn-export');
    exportBtn.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'planilha-ganhos-gastos.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    const importBtn = document.getElementById('btn-import');
    const importFile = document.getElementById('import-file');
    importBtn.addEventListener('click', () => importFile.click());
    importFile.addEventListener('change', async () => {
      const file = importFile.files?.[0];
      if (!file) return;
      try {
        const text = await file.text();
        const json = JSON.parse(text);
        if (!Array.isArray(json)) throw new Error('Arquivo inválido');
        // Opcional: valida campos mínimos
        const ok = json.every(x => x && typeof x === 'object' && x.date && x.type && typeof x.amount === 'number');
        if (!ok) throw new Error('Estrutura inválida');
        data = json.map(x => ({ id: x.id || crypto.randomUUID(), ...x }));
        save(data);
        populateMonthYearSelectors();
        applyFilter();
        importFile.value = '';
        alert('Importado com sucesso!');
      } catch (err) {
        alert('Falha ao importar: ' + err.message);
      }
    });

    // ====== Qualidade de Vida ======
    // Preenche data de hoje no form e valor com máscara simples (BRL-like)
    document.getElementById('date').value = new Date().toISOString().slice(0, 10);

    const amountInput = document.getElementById('amount');
    amountInput.addEventListener('blur', () => {
      const n = parseBRL(amountInput.value);
      if (!isNaN(n)) amountInput.value = brl(n);
    });

    // Enter para navegar entre campos
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
        const inputs = Array.from(form.querySelectorAll('input, select'));
        const i = inputs.indexOf(e.target);
        if (i > -1 && i < inputs.length - 1) {
          e.preventDefault();
          inputs[i + 1].focus();
        }
      }
    });
  </script>
</body>

</html>
